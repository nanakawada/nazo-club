<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>イベント管理リスト（SPモーダル版）</title>
<style>
body { font-family:sans-serif; margin:0; padding:0; background:#f8f9fa; }
header { background:#343a40; color:white; text-align:center; padding:1rem; }
section { padding:1rem; }
input[type=text], input[type=number], button { padding:0.4rem; font-size:1rem; margin:0.3rem 0; }
table { width:100%; border-collapse: collapse; margin-top:0.5rem; overflow-x:auto; display:block; }
th, td { border:1px solid #ccc; padding:0.5rem; text-align:left; vertical-align:top; }
th { background:#e9ecef; }
.member-list { list-style:none; padding:0; }
.member-list li { padding:0.3rem 0; }
.member-row { cursor:pointer; padding:0.2rem 0; border-bottom:1px solid #ddd; }
.modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content {
  background:white;
  padding:1rem;
  border-radius:8px;
  width:80%;
  max-width:300px;
  text-align:center;
}
.modal-content button {
  display:block;
  width:100%;
  margin:0.5rem 0;
  font-size:1rem;
  padding:0.5rem;
}
@media (max-width:600px){
  input[type=text], input[type=number], button { width:60%; }
  table { font-size:0.9rem; }
}
</style>
</head>
<body>

<header>イベント管理リスト（SPモーダル版）</header>

<section id="members">
  <h2>メンバーリスト</h2>
  <input type="text" id="memberInput" placeholder="名前を追加">
  <button onclick="addMember()">追加</button>
  <ul id="memberList" class="member-list"></ul>
</section>

<section id="events">
  <h2>イベントリスト</h2>
  <input type="text" id="eventInput" placeholder="イベント名">
  <input type="number" id="eventNum" placeholder="必要人数" min="1" style="width:25%;">
  <button onclick="addEvent()">追加</button>
  <table id="eventTable">
    <tr>
      <th>イベント名</th>
      <th>参加済</th>
      <th>参加希望</th>
      <th>未参加</th>
      <th>人数</th>
    </tr>
  </table>
</section>

<!-- モーダル -->
<div id="statusModal" class="modal">
  <div class="modal-content">
    <h3 id="modalMemberName"></h3>
    <button onclick="setStatus('参加済')">参加済</button>
    <button onclick="setStatus('参加希望')">参加希望</button>
    <button onclick="setStatus('未参加')">未参加</button>
    <button onclick="closeModal()">キャンセル</button>
  </div>
</div>

<script>
let members = [];
let events = [];
let modalInfo = null;

// メンバー追加
function addMember(){
  const name = document.getElementById("memberInput").value.trim();
  if(!name || members.includes(name)) return;
  members.push(name);

  const ul = document.getElementById("memberList");
  const li = document.createElement("li");
  li.innerText = name;
  ul.appendChild(li);

  // 既存イベントに未参加として追加
  events.forEach(event => {
    event.status[name] = '未参加';
  });

  renderEvents();
  document.getElementById("memberInput").value="";
}

// イベント追加
function addEvent(){
  const name = document.getElementById("eventInput").value.trim();
  const num = document.getElementById("eventNum").value;
  if(!name || !num) return;

  let status = {};
  members.forEach(m => status[m]='未参加');
  events.push({name:name, num:num, status: status});

  renderEvents();
  document.getElementById("eventInput").value="";
  document.getElementById("eventNum").value="";
}

// モーダルで状態変更
function openModal(eventIndex, member){
  modalInfo = {eventIndex, member};
  document.getElementById("modalMemberName").innerText = member;
  document.getElementById("statusModal").style.display="flex";
}
function closeModal(){
  document.getElementById("statusModal").style.display="none";
  modalInfo = null;
}
function setStatus(status){
  if(modalInfo){
    events[modalInfo.eventIndex].status[modalInfo.member] = status;
    closeModal();
    renderEvents();
  }
}

// テーブル描画
function renderEvents(){
  const table = document.getElementById("eventTable");
  table.innerHTML = `
    <tr>
      <th>イベント名</th>
      <th>参加済</th>
      <th>参加希望</th>
      <th>未参加</th>
      <th>人数</th>
    </tr>
  `;

  events.forEach((event, idx)=>{
    const row = table.insertRow();

    // イベント名編集可
    const nameCell = row.insertCell(0);
    const nameInput = document.createElement("input");
    nameInput.type="text";
    nameInput.value = event.name;
    nameInput.onchange = e=>{ event.name = e.target.value; };
    nameCell.appendChild(nameInput);

    // 参加済、参加希望、未参加
    ['参加済','参加希望','未参加'].forEach((statusKey,colIndex)=>{
      const cell = row.insertCell(colIndex+1);
      Object.keys(event.status).forEach(member=>{
        if(event.status[member]===statusKey){
          const div = document.createElement("div");
          div.className="member-row";
          div.innerText = member;
          div.onclick = ()=> openModal(idx, member);
          cell.appendChild(div);
        }
      });
    });

    // 必要人数編集可
    const numCell = row.insertCell(4);
    const numInput = document.createElement("input");
    numInput.type="number";
    numInput.min="1";
    numInput.value = event.num;
    numInput.onchange = e=>{ event.num = e.target.value; };
    numCell.appendChild(numInput);
  });
}

// モーダル外クリックで閉じる
window.onclick = function(e){
  const modal = document.getElementById("statusModal");
  if(e.target===modal) closeModal();
}
</script>
</body>
</html>
